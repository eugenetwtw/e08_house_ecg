<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>House ECG - Structural Health Monitoring Concept</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chart-container {
            position: relative;
            height: 60vh; /* Responsive height */
            width: 100%;   /* Responsive width */
            max-width: 800px; /* Max width to maintain aspect ratio on large screens */
            margin: auto;
        }
        /* Custom styling for buttons and status messages */
        .btn-simulate {
            background-color: #3b82f6; /* Tailwind blue-500 */
            transition: background-color 0.3s ease;
        }
        .btn-simulate:hover {
            background-color: #2563eb; /* Tailwind blue-600 */
        }
        .status-normal {
            background-color: #d1fae5; /* Tailwind green-100 */
            color: #065f46; /* Tailwind green-800 */
            border-left-color: #10b981; /* Tailwind green-500 */
        }
        .status-warning {
            background-color: #ffedd5; /* Tailwind orange-100 */
            color: #9a3412; /* Tailwind orange-800 */
            border-left-color: #f97316; /* Tailwind orange-500 */
        }
        .status-danger {
            background-color: #fee2e2; /* Tailwind red-100 */
            color: #991b1b; /* Tailwind red-800 */
            border-left-color: #ef4444; /* Tailwind red-500 */
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 flex flex-col items-center justify-center min-h-screen p-4">
    <div class="w-full max-w-3xl flex justify-end mb-4">
        <div class="bg-white shadow rounded-lg p-2">
            <a href="index.html" class="px-3 py-1 text-gray-700 rounded hover:bg-gray-200">中文</a>
            <a href="index_en.html" class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600">English</a>
        </div>
    </div>

    <div class="bg-white shadow-xl rounded-lg p-6 md:p-8 w-full max-w-3xl">
        <header class="text-center mb-6">
            <h1 class="text-3xl font-bold text-sky-700">House ECG</h1>
            <p class="text-lg text-slate-600 mt-1">Structural Health Monitoring Concept Simulation</p>
            <p class="text-sm text-slate-500 mt-2">Repurpose outdated iPhones as monitoring tools by attaching them to walls and keeping them powered, recording earthquake acceleration data. Analyze frequency domain information via Fourier Transform, compare data across multiple earthquakes to detect structural stiffness changes, and notify users for inspection if significant drops are detected.</p>
            <div class="mt-3 text-xs text-slate-500 bg-slate-50 p-3 rounded">
                <strong>Simulated Case Study</strong>: Monitoring a 3-story residential building (theoretical natural frequency 3-5 Hz). During an earthquake, the iPhone records data synchronized with Taichung Meteorological Station. Station spectrum peaks at 0.5 Hz and 2 Hz, iPhone spectrum peaks at 0.5 Hz, 2 Hz, and 4 Hz, with transfer function confirming 4 Hz as the building's natural frequency. First earthquake frequency at 4.0 Hz, second at 3.8 Hz (5% decrease), triggering a warning to inspect the structure.
            </div>
        </header>

        <main>
            <section class="mb-6 grid grid-cols-1 md:grid-cols-2 gap-4 text-center">
                <div class="bg-sky-50 p-4 rounded-lg shadow">
                    <h2 class="text-md font-semibold text-sky-600">Baseline Structural Frequency</h2>
                    <p id="baselineFrequency" class="text-2xl font-bold text-sky-800">5.00 Hz</p>
                </div>
                <div class="bg-emerald-50 p-4 rounded-lg shadow">
                    <h2 class="text-md font-semibold text-emerald-600">Current Structural Frequency</h2>
                    <p id="currentFrequency" class="text-2xl font-bold text-emerald-800">5.00 Hz</p>
                </div>
            </section>

            <section class="mb-6">
                <h2 class="text-xl font-semibold text-center mb-3 text-slate-700">Real-Time Vibration Simulation</h2>
                <div class="chart-container bg-slate-50 p-2 rounded-lg shadow-inner">
                    <canvas id="vibrationChart"></canvas>
                </div>
            </section>

            <section class="text-center mb-6">
                <button id="simulateEarthquake" class="btn-simulate text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-75">
                    Simulate Earthquake Event
                </button>
            </section>

            <section id="statusMessageContainer" class="p-4 rounded-lg border-l-4 status-normal min-h-[60px] flex items-center justify-center">
                <p id="statusMessage" class="text-md font-medium">System normal, structure stable.</p>
            </section>
        </main>

        <footer class="text-center mt-8 text-sm text-slate-500">
            <p>&copy; 2025 Structural Monitoring App Concept Demo. For simulation purposes only.</p>
            <p class="mt-1">This application is a conceptual demo only, not representing real structural monitoring, and should not be used for actual building analysis or safety assessments.</p>
        </footer>
    </div>

    <script>
        // Chart.js initialization and configuration
        const ctx = document.getElementById('vibrationChart').getContext('2d');
        let vibrationChart;
        const chartData = {
            labels: Array(50).fill().map((_, i) => i), // X-axis labels (time points)
            datasets: [{
                label: 'Structural Vibration Amplitude',
                data: Array(50).fill(0), // Y-axis data (vibration amplitude)
                borderColor: 'rgb(59, 130, 246)', // Tailwind blue-500
                borderWidth: 2,
                tension: 0.4, // Smooth line
                pointRadius: 0, // Hide data points
                fill: false
            }]
        };
        const chartConfig = {
            type: 'line',
            data: chartData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: {
                    duration: 200 // Faster animation for real-time simulation
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        min: -1.5, // Amplitude range
                        max: 1.5,
                        title: {
                            display: true,
                            text: 'Vibration Amplitude (Simulation Unit)'
                        }
                    },
                    x: {
                        display: false // Hide X-axis labels to mimic ECG
                    }
                },
                plugins: {
                    legend: {
                        display: false // Hide legend
                    }
                }
            }
        };
        vibrationChart = new Chart(ctx, chartConfig);

        // DOM elements
        const baselineFrequencyDisplay = document.getElementById('baselineFrequency');
        const currentFrequencyDisplay = document.getElementById('currentFrequency');
        const simulateButton = document.getElementById('simulateEarthquake');
        const statusMessageContainer = document.getElementById('statusMessageContainer');
        const statusMessage = document.getElementById('statusMessage');

        // Initial state variables
        let baselineFrequency = 5.00; // Hz
        let currentFrequency = 5.00; // Hz
        let isEarthquakeSimulating = false;
        let intervalId;

        // Update frequency displays
        function updateFrequencyDisplays() {
            baselineFrequencyDisplay.textContent = `${baselineFrequency.toFixed(2)} Hz`;
            currentFrequencyDisplay.textContent = `${currentFrequency.toFixed(2)} Hz`;
        }

        // Update status message
        function updateStatusMessage(message, type) {
            statusMessage.textContent = message;
            statusMessageContainer.className = `p-4 rounded-lg border-l-4 min-h-[60px] flex items-center justify-center status-${type}`;
        }
        
        // Simulate vibration data update
        function updateChartData() {
            const newData = chartData.datasets[0].data;
            newData.shift(); // Remove oldest data point

            let amplitude = 0.5; // Normal amplitude
            if (isEarthquakeSimulating) {
                amplitude = 1.2 + Math.random() * 0.6 - 0.3; // Increased and irregular amplitude during earthquake
            } else {
                 // Adjust vibration "density" based on current frequency
                 // This is a very simplified simulation; actual frequency changes affect vibration period
                const randomFactor = (Math.random() - 0.5) * 2; // -1 to 1
                amplitude = (currentFrequency / baselineFrequency) * 0.3 * randomFactor + (Math.random() - 0.5) * 0.1;
            }
            
            newData.push(amplitude); // Add new data point
            vibrationChart.update();
        }

        // Start/stop vibration simulation
        function startVibrationSimulation() {
            if (intervalId) clearInterval(intervalId);
            // Adjust update speed based on current frequency; higher frequency means denser waveform, so update faster
            // This is a simplified simulation; actual effect is on waveform period
            let updateInterval = 200 / (currentFrequency / 2.5); // Base update interval 200ms, shorter interval for higher frequency
            updateInterval = Math.max(50, Math.min(500, updateInterval)); // Limit between 50ms and 500ms
            intervalId = setInterval(updateChartData, updateInterval);
        }


        // Simulate earthquake event
        simulateButton.addEventListener('click', () => {
            if (isEarthquakeSimulating) return; // Prevent multiple triggers

            isEarthquakeSimulating = true;
            simulateButton.disabled = true;
            simulateButton.textContent = 'Earthquake Simulation in Progress...';
            updateStatusMessage('Strong vibration detected! Analyzing structural response...', 'warning');
            
            // Simulate earthquake duration
            let earthquakeDuration = Math.random() * 3000 + 2000; // 2-5 seconds
            const originalFrequency = currentFrequency;

            // During earthquake, chart amplitude increases
            const earthquakeInterval = setInterval(updateChartData, 100); // Faster chart updates during earthquake

            setTimeout(() => {
                clearInterval(earthquakeInterval); // Stop fast updates during earthquake
                isEarthquakeSimulating = false;
                simulateButton.disabled = false;
                simulateButton.textContent = 'Simulate Earthquake Event';

                // Simulate structural stiffness change (frequency may decrease)
                // 70% chance of structural damage, frequency drops
                if (Math.random() < 0.7) {
                    const frequencyDropPercentage = Math.random() * 0.15 + 0.05; // Drop 5% - 20%
                    currentFrequency = originalFrequency * (1 - frequencyDropPercentage);
                } else {
                    // 30% chance of no damage or minor change
                    currentFrequency = originalFrequency * (1 - Math.random() * 0.03); // Drop up to 3%
                }
                currentFrequency = Math.max(0.1, currentFrequency); // Frequency won't be less than 0.1Hz
                
                updateFrequencyDisplays();
                checkStructuralIntegrity();
                startVibrationSimulation(); // Resume normal vibration simulation, possibly with new frequency

            }, earthquakeDuration);
        });

        // Check structural integrity and update status
        function checkStructuralIntegrity() {
            const frequencyChangePercentage = ((baselineFrequency - currentFrequency) / baselineFrequency) * 100;

            if (frequencyChangePercentage > 15) {
                updateStatusMessage(`Warning: Structural frequency significantly dropped by ${frequencyChangePercentage.toFixed(1)}%! Immediate professional structural inspection recommended.`, 'danger');
            } else if (frequencyChangePercentage > 7) {
                updateStatusMessage(`Caution: Structural frequency dropped by ${frequencyChangePercentage.toFixed(1)}%. Close monitoring advised, consider scheduling an inspection.`, 'warning');
            } else if (frequencyChangePercentage > 2) {
                 updateStatusMessage(`Structural frequency slightly dropped by ${frequencyChangePercentage.toFixed(1)}%. Currently stable, continue monitoring.`, 'normal');
            }
            else {
                updateStatusMessage('Structural analysis complete. Current condition stable.', 'normal');
            }
        }

        // Initialization
        updateFrequencyDisplays();
        startVibrationSimulation();
        updateStatusMessage('System normal, structure stable. Secure iPhone to wall and keep charged for monitoring.', 'normal');

    </script>
</body>
</html>
